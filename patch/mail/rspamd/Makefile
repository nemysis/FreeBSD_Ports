# $FreeBSD: head/mail/rspamd/Makefile 314960 2013-03-22 20:06:14Z makc $

PORTNAME=	rspamd
PORTVERSION=	0.5.4
CATEGORIES=	mail
MASTER_SITES=	http://cdn.bitbucket.org/vstakhov/rspamd/downloads/

MAINTAINER=	vsevolod@FreeBSD.org
COMMENT=	Fast spam filtering system

LICENSE=	BSD

LIB_DEPENDS=	pcre.3:${PORTSDIR}/devel/pcre \
		gmime-2.4:${PORTSDIR}/mail/gmime24 \
		event-1.4:${PORTSDIR}/devel/libevent

OPTIONS_DEFINE=	RSPAMD_GPERF RSPAMD_JUDY RSPAMD_REDIRECTOR

RSPAMD_GPERF_DESC=	Enable google perf-tools profiling
RSPAMD_JUDY_DESC=	Enable Judy arrays usage for performance
RSPAMD_REDIRECTOR_DESC=	Install HTTP redirector

USE_RC_SUBR=	rspamd

PLIST_SUB+=	ETCDIR=etc/rspamd \
		RSPAMDVERSION=${PORTVERSION}
CMAKE_ARGS+=	-DETC_PREFIX=${PREFIX}/etc -DPREFIX=${PREFIX} \
		-DBUILD_PORT=yes

USES=		cmake
USE_LDCONFIG=	yes

USE_GNOME=	glib20
USE_LUA=	5.1-
USE_SQLITE=	yes
USE_ICONV=	yes
USE_GETTEXT=	yes
USE_OPENSSL=	yes

MAN8=	rspamd.8
MAN1=	rspamc.1

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MRSPAMD_GPERF}
CMAKE_ARGS+=	-DENABLE_GPERF_TOOLS=ON
LIB_DEPENDS+=	profiler.1:${PORTSDIR}/devel/google-perftools
.endif

.if ${PORT_OPTIONS:MRSPAMD_JUDY}
LIB_DEPENDS+=	Judy:${PORTSDIR}/devel/judy
.endif

.if ${PORT_OPTIONS:MRSPAMD_REDIRECTOR}
USE_PERL5=	yes
CMAKE_ARGS+=	-DENABLE_REDIRECTOR=ON
PLIST_SUB+=	REDIRECTOR=""
USE_RC_SUBR+=	rspamd_redirector
RUN_DEPENDS+=	\
	p5-IO-Socket-SSL>=0:${PORTSDIR}/security/p5-IO-Socket-SSL \
	p5-IO-String>=0:${PORTSDIR}/devel/p5-IO-String \
	p5-XML-Parser>=0:${PORTSDIR}/textproc/p5-XML-Parser \
	p5-Term-ReadKey>=0:${PORTSDIR}/devel/p5-Term-ReadKey \
	p5-POE-Component-Client-DNS>=0:${PORTSDIR}/dns/p5-POE-Component-Client-DNS \
	p5-POE-Component-Client-HTTP>=0:${PORTSDIR}/www/p5-POE-Component-Client-HTTP \
	p5-POE-Component-Server-HTTP>=0:${PORTSDIR}/www/p5-POE-Component-Server-HTTP \
	p5-Cache-Memcached-Fast>=0:${PORTSDIR}/databases/p5-Cache-Memcached-Fast \
	p5-Proc-PidUtil>=0:${PORTSDIR}/sysutils/p5-Proc-PidUtil \
	p5-Proc-Daemon>=0:${PORTSDIR}/devel/p5-Proc-Daemon \
	p5-SWF-File>=0:${PORTSDIR}/graphics/p5-SWF-File
.else
PLIST_SUB+=	REDIRECTOR="@comment "
.endif

.include <bsd.port.mk>
